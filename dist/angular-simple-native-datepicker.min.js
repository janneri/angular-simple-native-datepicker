angular.module("angular-simple-native-datepicker",[]).service("CollectionUtil",function(){"use strict";this.filter=function(e,t){for(var n=[],a=0;a<e.length;a++)t(e[a])&&n.push(e[a]);return n},this.map=function(e,t){for(var n=[],a=0;a<e.length;a++)n.push(t(e[a]));return n},this.foreach=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},this.toSubArrays=function(e,t){for(var n=[],a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n},this.toObjects=function(e,t){return this.map(e,function(e){var n={};return n[t]=e,n})},this.contains=function(e,t,n){for(var a=e.length-1;a>=0;a--)if(n(e[a],t))return!0;return!1},this.remove=function(e,t,n){for(var a=e.length-1;a>=0;a--)n(e[a],t)&&e.splice(a,a+1);return!1}}).service("CalendarUtil",["CollectionUtil",function(e){"use strict";var t=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()),t},n=function(e,t){return e.setDate(e.getDate()+t),e};this.currentYearMonth=function(){var e=new Date;return{year:e.getFullYear(),month:e.getMonth()}},this.rollYearMonth=function(e,t){var n=new Date(e.year,e.month,1);return n.setMonth(n.getMonth()+t),e.year=n.getFullYear(),e.month=n.getMonth(),e};var a=function(e){if(0>e||e>6)throw Error("illegal day number "+e+", expecting a day between 0 and 6")},r=function(e,r,o){a(r);for(var i=(e.getDay(),t(e));i.getDay()!=r;)n(i,o);return i};this.rollMutableDate=n,this.reverseToDayNumber=function(e,t){return r(e,t,-1)},this.forwardToDayNumber=function(e,t){return r(e,t,1)},this.dateRangeBetween=function(e,n){if(e.getTime()>n.getTime())throw"start after end";for(var a=[],r=t(e);r.getTime()<=n.getTime();)a.push(t(r)),this.rollMutableDate(r,1);return a};var o=function(e){a(e);var t=e+6;return t>6?t-7:t};this.equalYearMonth=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()},this.equalDateWithoutTime=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},this.getMonth=function(t,n,a,r){var i=this.reverseToDayNumber(new Date(t,n,1),a),u=this.rollMutableDate(new Date(t,n+1,1),-1),s=this.forwardToDayNumber(u,o(a)),h=e.toObjects(this.dateRangeBetween(i,s),"date"),l=this,c=e.filter(h,function(t){return e.contains(r,t.date,l.equalDateWithoutTime)});e.foreach(c,function(e){e.selected=!0});var d=new Date(t,n,1),f=e.filter(h,function(e){return!l.equalYearMonth(d,e.date)});return e.foreach(f,function(e){e.outOfMonth=!0}),{weeks:e.toObjects(e.toSubArrays(h,7),"days")}}}]).directive("simpleNativeDatepicker",["CalendarUtil","CollectionUtil",function(e,t){"use strict";return{restrict:"A",template:'<div class="simpleNativeDatepicker"><span ng-show="showPrevMonthBtn" ng-click="moveMonth(-1)" class="prevMonthBtn">&lt;</span><span class="header">{{monthStr}} {{year}}</span><span ng-show="showNextMonthBtn" ng-click="moveMonth(1)" class="nextMonthBtn">&gt;</span><table><thead><tr><th ng-repeat="dayName in orderedDayNames">{{dayName}}</th></tr></thead><tbody><tr ng-repeat="week in calMonth.weeks"><td ng-class="{outOfMonth: day.outOfMonth, selected: day.selected}" ng-click="selectDate(day)" ng-repeat="day in week.days">{{day.date.getDate()}}</td></tr></tbody></table></div>',scope:{year:"=",month:"=",versionNumber:"=",selectedDates:"=",options:"="},link:function(n){var a={firstDayOfWeek:1,dayNames:["Su","Ma","Ti","Ke","To","Pe","La"],monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],daySelected:function(e){console.log("selected",e)},dayUnSelected:function(e){console.log("unselected",e)},showPrevMonthBtn:!0,showNextMonthBtn:!0,moveMonth:function(t){var a={year:n.year,month:n.month};e.rollYearMonth(a,t),n.year=a.year,n.month=a.month,n.versionNumber+=1}},r=angular.extend(a,n.options);n.orderedDayNames=r.dayNames.slice(r.firstDayOfWeek).concat(r.dayNames.slice(0,r.firstDayOfWeek)),n.selectDate=function(a){t.contains(n.selectedDates,a.date,e.equalDateWithoutTime)?(t.remove(n.selectedDates,a.date,e.equalDateWithoutTime),r.dayUnSelected(a.date)):(n.selectedDates.push(a.date),r.daySelected(a.date)),n.versionNumber+=1},n.moveMonth=r.moveMonth,n.showPrevMonthBtn=r.showPrevMonthBtn,n.showNextMonthBtn=r.showNextMonthBtn;var o=function(t,a,o){n.calMonth=[],n.calMonth=e.getMonth(t,a,r.firstDayOfWeek,o),n.monthStr=r.monthNames[a]};n.$watch("versionNumber",function(e){e&&o(n.year,n.month,n.selectedDates)})}}}]);