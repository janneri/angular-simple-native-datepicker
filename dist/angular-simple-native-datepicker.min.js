angular.module("angular-simple-native-datepicker",[]).service("CollectionUtil",function(){"use strict";this.filter=function(e,t){for(var a=[],n=0;n<e.length;n++)t(e[n])&&a.push(e[n]);return a},this.map=function(e,t){for(var a=[],n=0;n<e.length;n++)a.push(t(e[n]));return a},this.foreach=function(e,t){for(var a=0;a<e.length;a++)t(e[a])},this.toSubArrays=function(e,t){for(var a=[],n=0;n<e.length;n+=t)a.push(e.slice(n,n+t));return a},this.toObjects=function(e,t){return this.map(e,function(e){var a={};return a[t]=e,a})},this.contains=function(e,t,a){for(var n=e.length-1;n>=0;n--)if(a(e[n],t))return!0;return!1},this.remove=function(e,t,a){for(var n=e.length-1;n>=0;n--)a(e[n],t)&&e.splice(n,n+1);return!1}}).service("CalendarUtil",["CollectionUtil",function(e){"use strict";var t=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()),t},a=function(e,t){return e.setDate(e.getDate()+t),e};this.currentYearMonth=function(){var e=new Date;return{year:e.getFullYear(),month:e.getMonth()}},this.rollYearMonth=function(e,t){var a=new Date(e.year,e.month,1);return a.setMonth(a.getMonth()+t),e.year=a.getFullYear(),e.month=a.getMonth(),e};var n=function(e){if(0>e||e>6)throw Error("illegal day number "+e+", expecting a day between 0 and 6")},r=function(e,r,o){n(r);for(var i=(e.getDay(),t(e));i.getDay()!=r;)a(i,o);return i};this.rollMutableDate=a,this.reverseToDayNumber=function(e,t){return r(e,t,-1)},this.forwardToDayNumber=function(e,t){return r(e,t,1)},this.dateRangeBetween=function(e,a){if(e.getTime()>a.getTime())throw"start after end";for(var n=[],r=t(e);r.getTime()<=a.getTime();)n.push(t(r)),this.rollMutableDate(r,1);return n};var o=function(e){n(e);var t=e+6;return t>6?t-7:t};this.equalYearMonth=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()},this.equalDateWithoutTime=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},this.getMonth=function(t,a,n,r){var i=this.reverseToDayNumber(new Date(t,a,1),n),u=this.rollMutableDate(new Date(t,a+1,1),-1),s=this.forwardToDayNumber(u,o(n)),l=e.toObjects(this.dateRangeBetween(i,s),"date"),c=this,h=e.filter(l,function(t){return e.contains(r,t.date,c.equalDateWithoutTime)});e.foreach(h,function(e){e.selected=!0});var d=new Date(t,a,1),f=e.filter(l,function(e){return!c.equalYearMonth(d,e.date)});return e.foreach(f,function(e){e.outOfMonth=!0}),{weeks:e.toObjects(e.toSubArrays(l,7),"days")}}}]).directive("simpleNativeDatepicker",["CalendarUtil","CollectionUtil",function(e,t){"use strict";return{restrict:"A",template:'<div class="simpleNativeDatepicker"><span class="header">{{monthStr}} {{year}}</span><table><thead><tr><th ng-repeat="dayName in orderedDayNames">{{dayName}}</th></tr></thead><tbody><tr ng-repeat="week in calMonth.weeks"><td ng-class="{outOfMonth: day.outOfMonth, selected: day.selected}" ng-click="selectDate(day)" ng-repeat="day in week.days">{{day.date.getDate()}}</td></tr></tbody></table></div>',scope:{year:"=",month:"=",versionNumber:"=",selectedDates:"=",options:"="},link:function(a){var n={firstDayOfWeek:1,dayNames:["Su","Ma","Ti","Ke","To","Pe","La"],monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],daySelected:function(e){console.log("selected",e)},dayUnSelected:function(e){console.log("unselected",e)}},r=angular.extend(n,a.options);a.orderedDayNames=r.dayNames.slice(r.firstDayOfWeek).concat(r.dayNames.slice(0,r.firstDayOfWeek)),a.selectDate=function(n){t.contains(a.selectedDates,n.date,e.equalDateWithoutTime)?(t.remove(a.selectedDates,n.date,e.equalDateWithoutTime),r.dayUnSelected(n.date)):(a.selectedDates.push(n.date),r.daySelected(n.date)),a.versionNumber=a.versionNumber+1};var o=function(t,n,o){a.calMonth=[],a.calMonth=e.getMonth(t,n,r.firstDayOfWeek,o),a.monthStr=r.monthNames[n]};a.$watch("versionNumber",function(e){e&&o(a.year,a.month,a.selectedDates)})}}}]);