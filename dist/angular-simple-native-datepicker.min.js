angular.module("angular-simple-native-datepicker",[]).service("CollectionUtil",function(){"use strict";this.filter=function(e,t){for(var n=[],o=0;o<e.length;o++)t(e[o])&&n.push(e[o]);return n},this.map=function(e,t){for(var n=[],o=0;o<e.length;o++)n.push(t(e[o]));return n},this.foreach=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},this.toSubArrays=function(e,t){for(var n=[],o=0;o<e.length;o+=t)n.push(e.slice(o,o+t));return n},this.toObjects=function(e,t){return this.map(e,function(e){var n={};return n[t]=e,n})},this.contains=function(e,t,n){for(var o=e.length-1;o>=0;o--)if(n(e[o],t))return!0;return!1},this.remove=function(e,t,n){for(var o=e.length-1;o>=0;o--)n(e[o],t)&&e.splice(o,1);return!1}}).service("CalendarUtil",["CollectionUtil",function(e){"use strict";var t=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()),t},n=function(e,t){return e.setDate(e.getDate()+t),e};this.currentYearMonth=function(){var e=new Date;return{year:e.getFullYear(),month:e.getMonth()}},this.rollYearMonth=function(e,t){var n=new Date(e.year,e.month,1);return n.setMonth(n.getMonth()+t),e.year=n.getFullYear(),e.month=n.getMonth(),e};var o=function(e){if(0>e||e>6)throw Error("illegal day number "+e+", expecting a day between 0 and 6")},a=function(e,a,r){o(a);for(var u=(e.getDay(),t(e));u.getDay()!=a;)n(u,r);return u};this.rollMutableDate=n,this.reverseToDayNumber=function(e,t){return a(e,t,-1)},this.forwardToDayNumber=function(e,t){return a(e,t,1)},this.dateRangeBetween=function(e,n){if(e.getTime()>n.getTime())throw"start after end";for(var o=[],a=t(e);a.getTime()<=n.getTime();)o.push(t(a)),this.rollMutableDate(a,1);return o};var r=function(e){o(e);var t=e+6;return t>6?t-7:t};this.equalYearMonth=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()},this.equalDateWithoutTime=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},this.getMonth=function(t,n,o,a){var u=this.reverseToDayNumber(new Date(t,n,1),o),s=this.rollMutableDate(new Date(t,n+1,1),-1),i=this.forwardToDayNumber(s,r(o)),h=e.toObjects(this.dateRangeBetween(u,i),"date"),l=this,c=e.filter(h,function(t){return e.contains(a,t.date,l.equalDateWithoutTime)});e.foreach(c,function(e){e.selected=!0});var f=new Date(t,n,1),m=e.filter(h,function(e){return!l.equalYearMonth(f,e.date)});return e.foreach(m,function(e){e.outOfMonth=!0}),{weeks:e.toObjects(e.toSubArrays(h,7),"days")}}}]).directive("simpleNativeDatepicker",["CalendarUtil","CollectionUtil",function(e,t){"use strict";return{restrict:"A",template:'<div class="simpleNativeDatepicker" ng-mouseleave="onMouseLeave()" ng-mouseup="onMouseUp()"><span ng-show="showPrevMonthBtn" ng-click="moveMonth(-1)" class="prevMonthBtn">&lt;</span><span class="header">{{monthStr}} {{year}}</span><span ng-show="showNextMonthBtn" ng-click="moveMonth(1)" class="nextMonthBtn">&gt;</span><table><thead><tr><th ng-repeat="dayName in orderedDayNames">{{dayName}}</th></tr></thead><tbody><tr ng-repeat="week in calMonth.weeks"><td ng-class="{outOfMonth: day.outOfMonth, selected: day.selected}" ng-mousedown="onMouseDown(day)" ng-mouseenter="onMouseEnter(day)" ng-repeat="day in week.days">{{day.date.getDate()}}</td></tr></tbody></table></div>',scope:{year:"=",month:"=",versionNumber:"=",selectedDates:"=",options:"="},link:function(n){var o={firstDayOfWeek:1,dayNames:["Su","Ma","Ti","Ke","To","Pe","La"],monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],daySelected:function(e){console.log("selected",e)},dayUnSelected:function(e){console.log("unselected",e)},showPrevMonthBtn:!0,showNextMonthBtn:!0,moveMonth:function(t){var o={year:n.year,month:n.month};e.rollYearMonth(o,t),n.year=o.year,n.month=o.month,n.versionNumber+=1}},a=angular.extend(o,n.options);n.orderedDayNames=a.dayNames.slice(a.firstDayOfWeek).concat(a.dayNames.slice(0,a.firstDayOfWeek)),n.mouseDown=!1,n.year||(n.year=e.currentYearMonth().year),n.month||(n.month=e.currentYearMonth().month),n.onMouseLeave=function(){n.mouseDown=!1,n.versionNumber+=1},n.onMouseUp=function(){n.mouseDown=!1,n.versionNumber+=1},n.onMouseDown=function(e){n.mouseDown=!0,r(e)},n.onMouseEnter=function(e){n.mouseDown&&r(e)};var r=function(o){t.contains(n.selectedDates,o.date,e.equalDateWithoutTime)?(t.remove(n.selectedDates,o.date,e.equalDateWithoutTime),a.dayUnSelected(o.date)):(n.selectedDates.push(o.date),a.daySelected(o.date))};n.moveMonth=a.moveMonth,n.showPrevMonthBtn=a.showPrevMonthBtn,n.showNextMonthBtn=a.showNextMonthBtn;var u=function(t,o,r){n.calMonth=[],n.calMonth=e.getMonth(t,o,a.firstDayOfWeek,r),n.monthStr=a.monthNames[o]};n.$watch("versionNumber",function(e){e&&u(n.year,n.month,n.selectedDates)})}}}]);